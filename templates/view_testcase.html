<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Test Case - {{ game_name }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2>Test Case #{{ test_case.id }} - {{ test_case.title }} ({{ game_name }})</h2>
    <ul class="list-group my-4">
        <li class="list-group-item"><strong>Description:</strong> {{ test_case.description }}</li>
        <li class="list-group-item"><strong>Steps:</strong> {{ test_case.steps }}</li>
        <li class="list-group-item"><strong>Expected:</strong> {{ test_case.expected_result }}</li>
        <li class="list-group-item"><strong>Actual:</strong> {{ test_case.actual_result }}</li>
        <li class="list-group-item"><strong>Status:</strong> {{ test_case.status }}</li>
        <li class="list-group-item"><strong>Priority:</strong> {{ test_case.priority }}</li>
        <li class="list-group-item"><strong>Iteration:</strong> {{ test_case.iteration }}</li> <!-- ✅ Added Iteration -->
        <li class="list-group-item"><strong>Created By:</strong> {{ test_case.created_by or 'None' }}</li>
        <li class="list-group-item"><strong>Date:</strong> {{ test_case.date_created }}</li>
    </ul>

    <form method="post" action="{{ url_for('update_testcase', game_name=game_name, testcase_id=test_case.id) }}">
        <h4>Update Test Result</h4>
        <div class="mb-3">
            <textarea name="actual_result" class="form-control" placeholder="Actual Result">{{ test_case.actual_result }}</textarea>
        </div>
        <div class="mb-3">
            <select name="status" class="form-control">
                <option {% if test_case.status == 'Pass' %}selected{% endif %}>Pass</option>
                <option {% if test_case.status == 'Fail' %}selected{% endif %}>Fail</option>
                <option {% if test_case.status == 'To Do' %}selected{% endif %}>To Do</option>
                <option {% if test_case.status == 'Hold' %}selected{% endif %}>Hold</option>
                <option {% if test_case.status == 'Doubt' %}selected{% endif %}>Doubt</option>
                <option {% if test_case.status == 'Not applicable' %}selected{% endif %}>Not applicable</option>
                <option {% if test_case.status == 'Pending' %}selected{% endif %}>Pending</option>
            </select>
        </div>
        <button class="btn btn-primary">Update</button>
        <a href="{{ url_for('index', game_name=game_name) }}" class="btn btn-secondary">Back</a>
    </form>

    <!-- ✅ Iteration History Section -->
    {% if history %}
    <hr>
    <h4 class="mt-5">Test Result History</h4>
    <table class="table table-bordered table-sm">
        <thead class="table-light">
            <tr>
                <th>Iteration</th>
                <th>Status</th>
                <th>Actual Result</th>
                <th>Updated At</th>
            </tr>
        </thead>
        <tbody>
            {% for h in history %}
            <tr>
                <td>{{ h.iteration }}</td>
                <td>{{ h.status }}</td>
                <td>{{ h.actual_result }}</td>
                <td>{{ h.updated_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="mt-4">No update history available for this test case.</p>
    {% endif %}
</div>
</body>
</html>
